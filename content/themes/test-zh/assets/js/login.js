function DlgControl(){return{init:function(){this.setEvent()},setEvent:function(){var i=this;i.isResizing=!1,i.resizing=null,$(".soonIn").click(function(){return window.isMobile?location.href="/i?port=1":(i.showBlank(),i.showContainer($("#pageSoonLogin")),i.soonInDialog||(i.soonInDialog=new SoonInDialog(i),i.soonInDialog.init()),void i.soonInDialog.showWXCont())}),$(".loginDialog").click(function(){window.location.href="/i?port=2"}),$(".regDialog").click(function(){window.location.href="/i?port=1"}),$("#logAvatar").click(function(){i.goToSystem()}),$(window).keydown(function(o){27!=o.keyCode||$(".mask").is(":hidden")||i.hideDlg()}),$(window).resize(function(){i.isResizing?(clearTimeout(i.resizing),i.resizing=setTimeout(function(){i.resizeDlg(),i.isResizing=!1},500)):(i.isResizing=!0,i.resizing=setTimeout(function(){i.resizeDlg(),i.isResizing=!1},500))})},resizeDlg:function(){var i=$(".popup"),o=$(window).height(),n=$(window).width(),e=(o-i.height())/2,t=(n-i.width())/2;i.css({top:e,left:t})},showBlank:function(){var i=$(".popup"),o=$(document).height(),n=$(window).height(),e=$(window).width(),t=(n-i.height())/2,s=(e-i.width())/2;$(".mask").height(o).show(),i.show(),i.css({top:t,left:s}),setTimeout(function(){$("body").addClass("blurFont")},10)},hideDlg:function(){$(".popup").hide(),$(".mask").hide(),setTimeout(function(){$("body").removeClass("blurFont")},100)},showContainer:function(i){$(".popupContainer").removeClass("showing"),i.addClass("showing"),i.find("input").val(""),showErrorMsg(""),setTimeout(function(){},0)},goToSystem:function(i,o){if(window.isDev)return alert("登录成功， 开发环境下不会自动进入系统");i=i||!1;var n="/download.php";if(window.isMobile){if(location.pathname===n)return;return location.href=n+"?msg="+(o===!0?"注册":"登录")}i?window.location.href=BASE_URL+"/homePage":window.location.href="/app"}}}function showErrorMsg(i){$hackError.length||window.isMobile||($hackError=$(".errorPlace")),$hackError.html(i)}function SoonInDialog(i){var o=$("#pageSoonLogin");return{init:function(){this.setEvent()},setEvent:function(){var n=this,e=o.find(".rememberPsw"),t=o.find(".rememberBox");e.on("click",function(){t.toggleClass("active")}),$(document).click(function(){$(".emails input").prev().hide()}),$(".passwords").focus(function(){$(".emails input").prev().hide()}),$(".emails").keyup(function(i){n.showEmailSelect(i)}),$(document).keydown(function(i){var o=$(".searchResult");if(13==i.keyCode){var n=$("input:focus");(!o.is(":visible")||o.is(":visible")&&!$(".searchResult li").hasClass("highLight"))&&(n.parent().find(".btn").length?n.parent().find(".btn").click():n.parent().parent().find(".btn").click())}}),$(".cross").click(function(){i.hideDlg(),$(".options").hide()}),$(".findPsw").click(function(){window.location.href="/i?port=4"}),o.find(".switchWX").click(function(){n.showWXCont()}),o.find(".icon-fresh").click(function(){n.freshWxCont()}),o.find(".freshText").click(function(){n.freshWxCont()}),o.find(".switchQQ").click(function(){n.showQQCont()}),o.find(".switchLogin").click(function(){n.showLoginCont()}),o.find(".newUserReg").click(function(){window.location.href="/i?port=1"}),o.find(".soonLogBtn").unbind().click(function(){if($("#logBtn").attr("disabled"))return void showErrorMsg("登录失败，请稍后重试。"+contactUs);o.find(".logEmail").val(),o.find(".logPassword").val();n.login()}),o.find(".toQQLogin").on("click",function(){window.open("/task/qqOauth/toLogin")})},showErrorMsg:function(i){this.$hackError.html(i)},showEmailSelect:function(i){var o=$(i.target),n=jQuery.trim(o.val()),e=o.prev(),t=n.indexOf("@"),s=n.substring(0,t),r=n.substring(t),a=/.*[\u4e00-\u9fa5]+.*$/,c="",l=e.find("li");if(!e.is(":hidden"))if(40==i.keyCode)if(l.hasClass("highLight")){var h=e.find(".highLight");void 0!=h.next().html()&&(h.removeClass("highLight"),h.next().addClass("highLight"))}else l.eq(0).addClass("highLight");else if(38!=i.keyCode||l.eq(0).hasClass("highLight"))13==i.keyCode&&(e.find(".highLight").click(),i.stopPropagation(),i.preventDefault());else{var d=e.find(".highLight");d.removeClass("highLight"),d.prev().addClass("highLight")}if(""==n||""==s||t<0||a.test(s))return e.hide(),!1;for(var g=0;g<emai.length;g++)emai[g].indexOf(r)>=0&&(c=c+"<li class='emailItem' onclick='getEmail(this);' onmouseover='highLight(this);'>"+s+emai[g]+"</li>");if(""!=c&&38!=i.keyCode&&40!=i.keyCode&&13!=i.keyCode){e.html(c).show();var f=e.find("li");f.hasClass("highLight")||f.eq(0).addClass("highLight")}else""==c&&e.hide()},showQQCont:function(){o.find(".switcher ul li").removeClass("active"),o.find(".switchQQ").addClass("active"),o.find(".soonCont").hide(),o.find(".QQMain").show(),showErrorMsg("")},showWXCont:function(){o.find(".switcher ul li").removeClass("active"),o.find(".switchWX").addClass("active"),o.find(".soonCont").hide(),o.find(".WXMain").show(),showErrorMsg(""),this.freshWxCont()},freshWxCont:function(){new WxLogin({id:"login_container",appid:"wxf39b085a4d6ff3c7",scope:"snsapi_login",redirect_uri:"https://www.rishiqing.com/task/weixinOauth/afterLogin",state:"null_null_null_empty_empty_empty",style:"",href:"https://rsqsystem.oss-cn-beijing.aliyuncs.com/weixin/wx2ma.css"})},showLoginCont:function(){o.find(".switcher ul li").removeClass("active"),o.find(".switchLogin").addClass("active"),o.find(".soonCont").hide(),o.find(".soonLogMain").show(),this.getCookie(o.find(".logEmail"),o.find(".logPassword")),showErrorMsg("")},setCookie:function(i,o,n){$.cookie("userEmail",i,{expires:90}),n?($.cookie("notPsw",!0,{expires:90}),$.cookie("pwd","")):($.cookie("notPsw",""),$.cookie("pwd",o,{expires:90}))},getCookie:function(i,o){var n=$.cookie("userEmail"),e=$.cookie("pwd");n&&i.val(n),e&&o.val(e),$.cookie("notPsw")?$(".rememberBox").removeClass("active"):$(".rememberBox").addClass("active")},login:function(){var n=o.find(".logEmail"),e=o.find(".logEmail").val(),t=o.find(".logPassword"),s=o.find(".logPassword").val(),r=this;if(e)if(s)if(s.length<6)t.focus(),showErrorMsg("密码不能小于6位");else{var a={j_username:e,j_password:s,_spring_security_remember_me:!0};$.ajax({url:BASE_URL+SPRING_CHECK,data:a,type:"POST",success:function(n){if(n.success){var t=!o.find(".rememberBox").hasClass("active");r.setCookie(e,s,t),n.notCommonUser?i.goToSystem(!0):i.goToSystem()}else showErrorMsg(n.errors&&n.errors.message?n.errors.message:"登录失败！"+contactUs)},error:function(){this.showErrorMsg("登录失败！"+contactUs)}})}else t.focus(),showErrorMsg("请输入密码");else n.focus(),showErrorMsg("请输入邮箱或手机号")},usernameRegistered:function(i,o){var n=this;$.ajax({url:BASE_URL+usernameRegistered,type:"POST",data:{userName:i},success:function(i){var e=i.data;e.registered?showErrorMsg("该用户名已存在"):o.call(n)},error:function(){showErrorMsg("用户名有效性验证失败，请重试")}})}}}!function(i,o){function n(i){var n,e=o.createElement("iframe"),t="https://open.weixin.qq.com/connect/qrconnect?appid="+i.appid+"&scope="+i.scope+"&redirect_uri="+i.redirect_uri+"&state="+i.state+"&login_type=jssdk";t+=i.style?"&style="+i.style:"",t+=i.href?"&href="+i.href:"",e.src=t,e.frameBorder="0",e.allowTransparency="true",e.scrolling="no",e.width="179px",e.height="179px",n=o.getElementById(i.id),n.innerHTML="",n.appendChild(e)}i.WxLogin=n}(window,document);var joinNewTeam="/team/joinNewTeam",SPRING_CHECK="/j_spring_security_check",usernameRegistered="/reg/usernameRegistered",LIMIT_CHECK="/v2/teamAssertJoin/show",INVITE_CODE_CHECK="/reg/ajaxInvite",emai=["@163.com","@126.com","@gmail.com","@qq.com","@hotmail.com","@sina.com","@sina.cn","@sohu.com","@139.com","@tom.cn","@yeah.net","@sogou.com","@21cn.com","@yahoo.com.cn","@yahoo.cn","@aol.com"],emailMap={"@163.com":"http://mail.163.com","@126.com":"http://mail.126.com","@gmail.com":"https://mail.google.com","@qq.com":"https://mail.qq.com","@hotmail.com":"http://www.hotmail.com","@sina.com":"http://mail.sina.com.cn","@sohu.com":"http://mail.sohu.com","@139.com":"http://mail.10086.cn","@tom.com":"http://web.mail.tom.com","@yeah.net":"http://www.yeah.net","@sogou.com":"http://mail.sogou.com","@21cn.com":"http://mail.21cn.com","@yahoo.com":"http://mail.yahoo.com","@aol.com":"http://mail.aol.com"},contactUs="您还可以<a target='_blank' class='toUs' href='javascript:;' onclick = 'getService();'>在线咨询</a>",highLight=function(i){$("li.highLight").removeClass("highLight"),$(i).addClass("highLight")};!function(){window.isMobile&&$("#regEmail").attr({placeholder:"请输入您的手机号",pattern:"[0-9]"})}(),$.fn.disableBtn=function(){this.addClass("btn-disable")},$.fn.enableBtn=function(){this.removeClass("btn-disable")};var getEmail=function(i){var o=$(i).parent();o.next().val($(i).html()),o.hide();var n=$("input:focus");n.parent().find(".blueBtn").length?n.parent().find(".blueBtn").click():n.parent().parent().find(".blueBtn").click()},getInvitedInfo=function(i,o){var n={inviteCode:i};i&&(n.isNotSecret=!0);var e=o||function(){};$.ajax({url:BASE_URL+INVITE_CODE_CHECK,type:"get",data:n,success:function(i){e(i)},error:function(){}})},getService=function(){$("#online-kf").click()};$(function(){var i=new DlgControl;i.init(),String.prototype.endWith=function(i){return!(null==i||""==i||0==this.length||i.length>this.length)&&this.substring(this.length-i.length)==i}});var $hackError=window.isMobile?$(".error-place-hack"):$(".errorPlace");
!function(){function t(){}var i="/task";!function(t,i){function n(t){var n,e=i.createElement("iframe"),s="https://open.weixin.qq.com/connect/qrconnect?appid="+t.appid+"&scope="+t.scope+"&redirect_uri="+t.redirect_uri+"&state="+t.state+"&login_type=jssdk";s+=t.style?"&style="+t.style:"",s+=t.href?"&href="+t.href:"",e.src=s,e.frameBorder="0",e.allowTransparency="true",e.scrolling="no",e.width="179px",e.height="179px",n=i.getElementById(t.id),n.innerHTML="",n.appendChild(e)}t.WxLogin=n}(window,document);var n="/reg/register",e="/reg/phoneRegistered",s="/reg/validateSmsWithPhone",o=["@163.com","@126.com","@gmail.com","@qq.com","@hotmail.com","@sina.com","@sina.cn","@sohu.com","@139.com","@tom.cn","@yeah.net","@sogou.com","@21cn.com","@yahoo.com.cn","@yahoo.cn","@aol.com"],r={"@163.com":"http://mail.163.com","@126.com":"http://mail.126.com","@gmail.com":"https://mail.google.com","@qq.com":"https://mail.qq.com","@hotmail.com":"http://www.hotmail.com","@sina.com":"http://mail.sina.com.cn","@sohu.com":"http://mail.sohu.com","@139.com":"http://mail.10086.cn","@tom.com":"http://web.mail.tom.com","@yeah.net":"http://www.yeah.net","@sogou.com":"http://mail.sogou.com","@21cn.com":"http://mail.21cn.com","@yahoo.com":"http://mail.yahoo.com","@aol.com":"http://mail.aol.com"},a=/^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/,c=/^\d{11}$/;String.prototype.includes=String.prototype.includes||function(t){return this.indexOf(t)!==-1};var l=$("body");$(".login-by-MM").click(function(){l.addClass("show-mask")}),$(document).click(function(t){var i=$(t.target);i.hasClass("login-by-MM")||i.hasClass("mail-item")||i.parents(".mask-box").length||l.removeClass("show-mask")}),t.prototype={initReg:function(t){this.$root=t,this.$user=t.find(".email"),this.$pass=t.find(".password"),this.$name=t.find(".username"),this.$msg=t.find(".error-msg"),this.$mail=t.find(".sign-up-mail"),this.$phone=t.find(".sign-up-phone"),this.$emailList=t.find(".email-list"),this.$regBtn=t.find(".sign-up-btn"),this.bindEvents(),this.getWXIMG()},setEmailList:function(t){this.$emailList.html(t),this.setActive()},clearEmailList:function(){this.$emailList.empty(),this.$emailList[0].activeEle=null},setActive:function(t){var i=this.$emailList;(!t||t&&0===t.length)&&(t=i.find("li:first")),t.addClass("active"),i[0].activeEle&&i[0].activeEle.removeClass("active"),i[0].activeEle=t},bindEvents:function(){this.bindKeyUpEvents(),this.bindKeyDownEvents(),this.bindRegBtnClickEvents(),this.bindEmailListClickEvents(),this.bindWXevents()},bindKeyUpEvents:function(){var t=this;this.$user.keyup(function(i){var n=$(this),e=n.val(),s=e.indexOf("@"),r=e.slice(s),a="";t.$emailList;return s===-1||0===s?t.clearEmailList():void([38,13,40].indexOf(i.keyCode)===-1&&(o.filter(function(t){return t.includes(r)}).forEach(function(t){a+='<li class = "mail-item">'+e.slice(0,s)+t+"</li>"}),t.setEmailList(a)))})},prevent:function(t){t.preventDefault(),t.stopPropagation()},bindKeyDownEvents:function(){var t=this;this.$user.keydown(function(i){var n=i.keyCode,e=t.$emailList,s=e[0].activeEle,o=null;if(s)return 13===n&&s?(t.isSelectItem=!0,void s.click()):void(38!==n&&40!==n||(38===n&&(o=0===s.index()?e.find("li:last"):s.prev("li")),40===n&&(o=s.index()===e[0].childElementCount?e.find("li:first"):s.next("li")),t.setActive(o),t.prevent(i),e.animate({scrollTop:26*o.index()+"px"},0)))}),this.$root.find("ul:first input").keydown(function(i){13===i.keyCode&&t.isSelectItem===!1?t.$regBtn.click():t.isSelectItem=!1})},bindEmailListClickEvents:function(){var t=this;this.$emailList.on("click","li",function(i){var n=$(i.target),e=(t.$emailList,t.$user);e.val(n.text()),t.clearEmailList()}),this.$user.blur(function(){setTimeout(function(){t.clearEmailList()},10)})},bindRegBtnClickEvents:function(){var t=this;this.$regBtn.click(function(){var i=t.$user,n=t.$pass,e=t.$name,s=(t.$msg,i.val()),o=n.val(),r=e.val();return a.test(s)||c.test(s)?o.length<6?t.showErrorMsg("密码不能小于6位"):""===r?t.showErrorMsg("请输入您的真实姓名"):(t.showErrorMsg(""),void(c.test(s)?t.setForPhone(s):t.setForMail(s))):t.showErrorMsg("用户名错误， 请输入邮箱或手机号")})},showErrorMsg:function(t){this.$msg.html(t)},clearMsg:function(){this.$msg.html("")},setForPhone:function(t){var n=this;$.post(i+e,{phoneNumber:t}).done(function(i){return i.data.registered?n.showErrorMsg("该手机号已存在"):void n.showPhone(t)}).fail(function(){n.showErrorMsg("手机号验证失败， 请重试")})},setForMail:function(t){var e=this;$.post(i+n,{username:t,password:e.$pass.val(),realName:e.$name.val(),createdByClient:"web"}).done(function(i){return i.success?e.showMail(t):void e.showErrorMsg("注册失败，请再次尝试")}).fail(function(){e.showErrorMsg("注册失败，请再次尝试")})},showMail:function(t){this.$root.addClass("show-mail"),this.$root.find(".email-addr").text(t),this.$root.find(".login-mail").attr("href",r[t.slice(t.indexOf("@"))])},showPhone:function(t){this.initForPhone(t),this.startCount(t),this.$root.addClass("show-phone"),this.$root.find(".phone-number").val(t)},initForPhone:function(t){this.$reSend=this.$root.find(".re-send"),this.timer=null,this.$valiCode=this.$root.find(".validate-code"),this.bindConfirmClickEvents(t),this.bindReSendClickEvents()},bindConfirmClickEvents:function(t){var i=this;this.$root.find(".confirm").click(function(){var n=i.$valiCode.val();return/^[0-9]{4}$/.test(n)?void i.validateCode(t,n):i.showErrorMsg("请输入有效的4位数字验证码")})},validateCode:function(t,n){var e=this;$.post(i+s,{phone:t,valicode:n}).done(function(i){return i.success?void e.signUpByPhone(t):e.showErrorMsg("验证失败， 请重试")}).fail(function(){e.showErrorMsg("注册失败， 请重试")})},signUpByPhone:function(t){var e=this;$.post(i+n,{username:t+"@rishiqing.com",phoneNumber:t,password:e.$pass.val(),realName:e.$name.val(),client:"webByPhone"}).done(function(t){return t.success?void(location.href="/app"):e.showErrorMsg("注册失败， 请重试")}).fail(function(){e.showErrorMsg("注册失败， 请重试")})},bindReSendClickEvents:function(){var t=this;this.$reSend.click(function(){t.startCount(t.$user.val())})},startCount:function(t){if(!this.timer){var i=60,n=this;this.sendCode(t,function(t){null===t&&(n.$reSend.text(i--).addClass("disable"),n.timer=setInterval(function(){return 0===i?n.endCount():void n.$reSend.text(i--)},1e3))})}},endCount:function(){this.$reSend.removeClass("disable").text("重发"),clearInterval(this.timer),this.timer=null},sendCode:function(t,n){var e=n||function(){},s="qc:qc:qc:qc",o="/reg/sendCellphoneValidataCode",r=this;$.ajax({url:i+o,type:"POST",data:{phone:t,phoneMac:s},success:function(t){t.success?(r.showErrorMsg("验证码发送成功"),r.showErrorMsg(""),e(null)):t.errors?(r.showErrorMsg(t.errors),e(t)):(r.showErrorMsg("发送失败，请稍候重试."),e(t))},error:function(t){r.showErrorMsg("验证码发送失败,请稍候重试"),e(t)}})},getWXIMG:function(){new WxLogin({id:"login_container",appid:"wxf39b085a4d6ff3c7",scope:"snsapi_login",redirect_uri:"https://www.rishiqing.com/task/weixinOauth/afterLogin",state:"null_null_null_empty_empty_empty",style:"",href:"https://rsqsystem.oss-cn-beijing.aliyuncs.com/weixin/wx2ma.css"})},bindWXevents:function(){var t=this;$(".refresh").on("click",".r",function(){t.getWXIMG()})}},$(".sign-up").each(function(i,n){(new t).initReg($(n))})}();